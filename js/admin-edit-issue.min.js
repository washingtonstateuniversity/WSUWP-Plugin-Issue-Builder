!function(d,t){var s=d("#wsuwp-issue-posts-stage");function i(){var n;d(".wsuwp-spine-builder-column").sortable({connectWith:".wsuwp-spine-builder-column",handle:".ttfmake-sortable-handle",opacity:.6,placeholder:"wswp-issue-post-placeholder",start:function(e,s){n=d(s.item).parent()},stop:function(e,s){var i=s.item.siblings(".issue-post"),a=s.item.closest("#ttfmake-stage"),t=s.item.closest("#wsuwp-issue-posts-stage");i&&a.length&&d(i).appendTo(n),t.length&&(s.item.find(".handlediv").removeClass("wsuwp-toggle-closed"),s.item.find(".wsuwp-issue-post-body").css("display","")),u()}})}function n(e){var t="";d.each(e,function(e,s){var i=s.featured_image?"<img src='"+s.featured_image+"'/>":"",a=s.thumbnail_image?"<img src='"+s.thumbnail_image+"'/>":"";t+="<div id='issue-post-"+s.id+"' class='issue-post' data-classes data-header='"+s.title+"' data-subheader data-display-image data-display-excerpt data-background-image data-background-position><div class='ttfmake-sortable-handle' title='Drag-and-drop this post into place'><a href='#' class='spine-builder-column-configure'><span>Configure this column</span></a><a href='#' class='wsuwp-column-toggle' title='Click to toggle'><div class='handlediv'></div></a><div class='wsuwp-builder-column-title'>"+s.title+"</div></div><article class='wsuwp-issue-post-body wsuwp-column-content'><header><h2>"+s.title+"</h2><p class='subheader'></p></header><figure class='featured-image'>"+i+"</figure><figure class='thumbnail-image'>"+a+"</figure><div class='excerpt'>"+s.excerpt+"</div></article></div>"}),s.html(t),i()}function u(){var i="",e=d("#ttfmake-stage").find(".wsuwp-spine-builder-column");d.each(e,function(){var e=d(this),s=e.children(".issue-post");if(s.length){var i=s[0].id.replace("issue-post-",""),a="yes"===s.data("display-excerpt"),t=s.data("background-image");e.children(".wsuwp-column-post-id").val(i),e.find(".spine-builder-column-classes").val(s.data("classes")),e.find(".spine-builder-column-header").val(s.data("header")),e.find(".spine-builder-column-subheader").val(s.data("subheader")),e.find(".spine-builder-column-display-image").val(s.data("display-image")),e.find(".spine-builder-column-display-excerpt").prop("checked",a),e.find(".spine-builder-column-background-image").val(t),t.length?e.find(".spine-builder-column-set-background-image").html("<img src='"+t+"' />").next(".spine-builder-column-remove-background-image").show():e.find(".spine-builder-column-set-background-image").html("Set background image").next(".spine-builder-column-remove-background-image").hide(),e.find(".spine-builder-column-background-position").val(s.data("background-position"))}else e.find(".wsuwp-issue-post-meta").val(""),e.find(".spine-builder-column-set-background-image").html("Set background image").next(".spine-builder-column-remove-background-image").hide()});var a=s.sortable("toArray");d.each(a,function(e,s){i=s.replace("issue-post-",""),a[e]=i}),d("#issue-staged-posts").val(a)}t.wsuwp_issue.items instanceof Array&&n(t.wsuwp_issue.items),i(),d("#load-issue-posts").on("click",function(e){e.preventDefault();var s=d("#post-start-date").val(),i=d("#post-end-date").val();if(""===s||""===i)return t.alert("Please select both a start and end date."),!1;var a={action:"set_issue_posts",nonce:t.wsuwp_issue.nonce,start_date:s,end_date:i};d.post(t.ajaxurl,a,function(e){n(d.parseJSON(e)),u()})}),d(".ttfmake-menu-list").on("click",".ttfmake-menu-list-item",function(){$oneApp.on("afterSectionViewAdded",function(){i()})}),d("#ttfmake-stage").on("change",".wsuwp-issue-post-meta",function(){var e=d(this),s=e.closest(".wsuwp-spine-builder-column").find(".issue-post"),i=e.val();e.hasClass("spine-builder-column-header")&&s.data("header",i).find("h2").html(i),e.hasClass("spine-builder-column-subheader")&&s.data("subheader",i).find(".subheader").html(i),e.hasClass("spine-builder-column-display-image")&&s.data("display-image",i).attr("data-display-image",i),e.hasClass("spine-builder-column-display-excerpt")&&(e.is(":checked")?s.data("display-excerpt","yes").find(".excerpt").show():s.data("display-excerpt","").find(".excerpt").hide()),e.hasClass("spine-builder-column-background-position")&&s.data("background-position",i).find(".wsuwp-issue-post-body").css("background-position",i.replace(/-/g," "))})}(jQuery,window),function(a){"use strict";var t;a("#ttfmake-stage").on("click",".spine-builder-column-set-background-image",function(e){e.preventDefault();var i=a(this);(t=window.wp.media({title:"Choose Image",button:{text:"Choose Image"},multiple:!1})).on("select",function(){var e=t.state().get("selection").first().toJSON(),s=e.sizes.hasOwnProperty("spine-large_size")?e.sizes["spine-large_size"].url:e.url;i.html("<img src='"+s+"' />").prev(".spine-builder-column-background-image").val(s).trigger("change").siblings(".spine-builder-column-remove-background-image").show().closest(".wsuwp-spine-builder-column").find(".issue-post").data("background-image",s).find(".wsuwp-issue-post-body").css("background-image","url( "+s+" )")}),t.open()}),a("#ttfmake-stage").on("click",".spine-builder-column-remove-background-image",function(e){e.preventDefault();var s=a(this).closest(".wsuwp-spine-builder-column");a(this).hide().prev(".spine-builder-column-set-background-image").html("Set background image").prev(".spine-builder-column-background-id").val(""),s.find(".spine-builder-column-background-position").val(""),s.find(".issue-post").data("background-id","").data("background-position","").data("background-image","").find(".wsuwp-issue-post-body").css("background-image","")})}(jQuery);